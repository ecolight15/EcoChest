# EcoChest

EcoChestは、Minecraftサーバー用のチェストアクセスログプラグインです。チェスト、かまど、ディスペンサー、ホッパーなどのコンテナへのプレイヤーアクセスを記録し、検索機能を提供します。

## 主な機能

- **コンテナアクセスログ記録**: チェスト、トラップチェスト、ディスペンサー、かまど、醸造台、ホッパー、ドロッパーへのアクセスを記録
- **カート・馬のインベントリ対応**: チェスト付きトロッコや馬のインベントリアクセスも記録
- **ログ検索機能**: 日付範囲指定やページング機能付きのログ検索
- **右クリック検索**: コンテナを右クリックしてログを直接確認
- **LWC連携**: LWC（Lightweight Chest Protection）プラグインとの連携によるアクセス権限チェック
- **SQLiteデータベース**: 軽量なSQLiteデータベースでログを永続化

## 必要な依存関係

- **Minecraft**: 1.18以上
- **Spigot/Paper**: 1.20.4対応
- **EcoFramework**: 0.21以上（必須）
- **LWC (Modern-LWC)**: 2.1.2以上（必須）

## インストール方法

1. EcoFrameworkプラグインをサーバーの`plugins`フォルダに配置
2. LWC (Modern-LWC)プラグインをサーバーの`plugins`フォルダに配置
3. EcoChest.jarファイルをサーバーの`plugins`フォルダに配置
4. サーバーを再起動

## コマンド

### `/ec [ページ数] [日付]`
チェストアクセスログを検索します。

**使用例:**
```
/ec                    # 過去24時間のログを1ページ目から表示
/ec 2                  # 過去24時間のログを2ページ目から表示
/ec 1 2024-06-07       # 2024年6月7日のログを1ページ目から表示
/ec 3 2024-06-07       # 2024年6月7日のログを3ページ目から表示
```

**パラメータ:**
- `ページ数`: 表示するページ番号（省略時は1）
- `日付`: 検索対象の日付（YYYY-MM-DD形式、省略時は過去24時間）

### `/ec reload`
プラグインの設定ファイルを再読み込みします（OP権限必要）。

## 使用方法

### ログ記録
プラグインは以下のアクションを自動的に記録します：
- チェスト類のアクセス
- アイテムの出し入れ
- クリックタイプ（左クリック、右クリック、シフトクリックなど）
- アクセス時刻
- プレイヤー名

### ログ検索
1. `/ec`コマンドでログを検索
2. 対象のコンテナを右クリックしてログを直接確認（検索モード時）

**検索モードの使用手順:**
1. `/ec`コマンドを実行
2. メッセージに従い、調査したいコンテナを右クリック
3. そのコンテナのアクセスログが表示されます

## 設定

プラグインは自動的に設定ファイルを生成します。特別な設定は必要ありません。

## データベース

ログは`plugins/EcoChest/chest.db`のSQLiteファイルに保存されます。データベースには以下の情報が記録されます：
- アクション ID
- 実行時刻
- コンテナの位置情報
- プレイヤー名
- 実行されたアクション

## ビルド方法

このプラグインをソースからビルドするには：

```bash
git clone https://github.com/ecolight15/EcoChest.git
cd EcoChest
mvn clean package
```

ビルドされたJARファイルは`target/`フォルダに生成されます。

**注意**: ビルドには以下の依存関係へのアクセスが必要です：
- Spigot API
- EcoFramework
- Modern-LWC

## トラブルシューティング

### 権限エラー
LWCと連携している場合、チェストにアクセス権限がないとログが表示されません。適切な権限を設定してください。

### データベースエラー
データベースファイルが破損した場合は、`plugins/EcoChest/chest.db`を削除してサーバーを再起動してください（ログデータは失われます）。

## ライセンス

このプラグインはGNU Lesser General Public License v3.0の下で公開されています。詳細は[LICENSE](LICENSE)ファイルを参照してください。

## 開発者情報

- **バージョン**: 0.5
- **パッケージ**: jp.minecraftuser.ecolight.ecochest
- **メインクラス**: EcoChest
